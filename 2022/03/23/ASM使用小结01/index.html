<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ASM使用小结01"><meta name="keywords" content="ASM,IAST,Java"><meta name="author" content="Sys71m"><meta name="copyright" content="Sys71m"><title>ASM使用小结01 | sys71m</title><link rel="shortcut icon" href="/lufei.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><link rel="alternate" href="/atom.xml" title="sys71m" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ClassFile结构"><span class="toc-number">1.</span> <span class="toc-text">ClassFile结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#描述符"><span class="toc-number">2.</span> <span class="toc-text">描述符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASM作用"><span class="toc-number">3.</span> <span class="toc-text">ASM作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#运行方式"><span class="toc-number">4.</span> <span class="toc-text">运行方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#体系结构"><span class="toc-number">5.</span> <span class="toc-text">体系结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASM生成类"><span class="toc-number">6.</span> <span class="toc-text">ASM生成类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ClassVisitor类"><span class="toc-number">6.1.</span> <span class="toc-text">ClassVisitor类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FieldVisitor类"><span class="toc-number">6.2.</span> <span class="toc-text">FieldVisitor类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MethodVisitor类"><span class="toc-number">6.3.</span> <span class="toc-text">MethodVisitor类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ClassWriter类"><span class="toc-number">6.4.</span> <span class="toc-text">ClassWriter类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FieldWriter类"><span class="toc-number">6.5.</span> <span class="toc-text">FieldWriter类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MethodWriter类"><span class="toc-number">6.6.</span> <span class="toc-text">MethodWriter类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成一个类"><span class="toc-number">7.</span> <span class="toc-text">生成一个类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#生成一个HelloWorld接口"><span class="toc-number">7.1.</span> <span class="toc-text">生成一个HelloWorld接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#生成一个HelloWorld类"><span class="toc-number">7.2.</span> <span class="toc-text">生成一个HelloWorld类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASM读取类"><span class="toc-number">8.</span> <span class="toc-text">ASM读取类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ClassReader类"><span class="toc-number">8.1.</span> <span class="toc-text">ClassReader类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#读取一个类"><span class="toc-number">9.</span> <span class="toc-text">读取一个类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#编译HelloWorld类"><span class="toc-number">9.1.</span> <span class="toc-text">编译HelloWorld类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读取HelloWorld-class"><span class="toc-number">9.2.</span> <span class="toc-text">读取HelloWorld.class</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#转换一个类"><span class="toc-number">10.</span> <span class="toc-text">转换一个类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为HelloWorld类添加接口"><span class="toc-number">10.1.</span> <span class="toc-text">为HelloWorld类添加接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#为HelloWorld类添加字段"><span class="toc-number">10.2.</span> <span class="toc-text">为HelloWorld类添加字段</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://raw.githubusercontent.com/ttonys/gitPic/master/lufei.jpg"></div><div class="author-info__name text-center">Sys71m</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/ttonys">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">38</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">55</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">22</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://raw.githubusercontent.com/ttonys/MarkDownPic/master/test33.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">sys71m</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/recon">Recon</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">ASM使用小结01</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-03-23</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/ASM/">ASM</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2022/03/23/ASM使用小结01/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2022/03/23/ASM使用小结01/"></span></a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">3.1k</span><span class="post-meta__separator">|</span><span>Reading time: 14 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>IAST前置知识，使用ASM进行字节码增强</p>
<a id="more"></a>  
<h2 id="ClassFile结构"><a href="#ClassFile结构" class="headerlink" title="ClassFile结构"></a>ClassFile结构</h2><ul>
<li><p>ASM对Class文件的操作都是基于ClassFile的文件结构，了解ClassFile文件结构有助于更好的理解ASM。</p>
</li>
<li><p>u1、u2分别代表几个字节</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ClassFile &#123;</span><br><span class="line">    u4             magic;</span><br><span class="line">    u2             minor_version;</span><br><span class="line">    u2             major_version;</span><br><span class="line">    u2             constant_pool_count;</span><br><span class="line">    cp_info        constant_pool[constant_pool_count-1];</span><br><span class="line">    u2             access_flags;</span><br><span class="line">    u2             this_class;</span><br><span class="line">    u2             super_class;</span><br><span class="line">    u2             interfaces_count;</span><br><span class="line">    u2             interfaces[interfaces_count];</span><br><span class="line">    u2             fields_count;</span><br><span class="line">    field_info     fields[fields_count];</span><br><span class="line">    u2             methods_count;</span><br><span class="line">    method_info    methods[methods_count];</span><br><span class="line">    u2             attributes_count;</span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="描述符"><a href="#描述符" class="headerlink" title="描述符"></a>描述符</h2><p>对ASM中常用的字段描述符的举例：</p>
<ul>
<li><code>boolean flag</code>: <code>Z</code></li>
<li><code>byte byteValue</code>: <code>B</code></li>
<li><code>int intValue</code>: <code>I</code></li>
<li><code>float floatValue</code>: <code>F</code></li>
<li><code>double doubleValue</code>: <code>D</code></li>
<li><code>String strValue</code>: <code>Ljava/lang/String;</code></li>
<li><code>Object objValue</code>: <code>Ljava/lang/Object;</code></li>
<li><code>byte[] bytes</code>: <code>[B</code></li>
<li><code>String[] array</code>: <code>[Ljava/lang/String;</code></li>
<li><code>Object[][] twoDimArray</code>: <code>[[Ljava/lang/Object;</code></li>
</ul>
<p>对方法描述符的举例：</p>
<ul>
<li><code>int add(int a, int b)</code>: <code>(II)I</code></li>
<li><code>void test(int a, int b)</code>: <code>(II)V</code></li>
<li><code>boolean compare(Object obj)</code>: <code>(Ljava/lang/Object;)Z</code></li>
<li><code>void main(String[] args)</code>: <code>([Ljava/lang/String;)V</code></li>
</ul>
<h2 id="ASM作用"><a href="#ASM作用" class="headerlink" title="ASM作用"></a>ASM作用</h2><ul>
<li><code>.java</code>文件经过javac编译为<code>.class</code>，ASM可直接对<code>.class</code>文件进行操作</li>
<li>ASM用来操作字节码文件，不止java语言，只要符合java字节码规范即可</li>
</ul>
<h2 id="运行方式"><a href="#运行方式" class="headerlink" title="运行方式"></a>运行方式</h2><ul>
<li>基于事件-核心API？</li>
<li>基于对象-树API？ </li>
</ul>
<h2 id="体系结构"><a href="#体系结构" class="headerlink" title="体系结构"></a>体系结构</h2><ul>
<li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/package-summary.html" target="_blank" rel="noopener">org.objectweb.asm</a>：包中定义类基于核心 <code>API</code> 的相关操作类；</li>
<li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/commons/package-summary.html" target="_blank" rel="noopener">org.objectweb.asm.commons</a>：包中提供了实用的类或方法的 <code>Adapter</code> 方法转换器；</li>
<li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/signature/package-summary.html" target="_blank" rel="noopener">org.objectweb.asm.signature</a>：包中重定义了泛型相关的操作类；</li>
<li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/tree/package-summary.html" target="_blank" rel="noopener">org.objectweb.asm.tree</a>：包中定义了基于树 <code>API</code> 的类，以及一些用于事件和树 <code>API</code> 转换的工具类；</li>
<li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/tree/analysis/package-summary.html" target="_blank" rel="noopener">org.objectweb.asm.tree.analysis</a>：包中提供了常见的类分析框架和分析器类；</li>
<li><a href="https://asm.ow2.io/javadoc/org/objectweb/asm/util/package-summary.html" target="_blank" rel="noopener">org.objectweb.asm.util</a>：包中提供了基于核心 <code>API</code> 的常见工具类。</li>
</ul>
<h2 id="ASM生成类"><a href="#ASM生成类" class="headerlink" title="ASM生成类"></a>ASM生成类</h2><h3 id="ClassVisitor类"><a href="#ClassVisitor类" class="headerlink" title="ClassVisitor类"></a>ClassVisitor类</h3><ul>
<li><p>一个抽象类，常见实现类-&gt;ClassWrite、ClassNode</p>
</li>
<li><p>访问者模式</p>
</li>
<li><p>有调用顺序</p>
<ul>
<li><code>[]</code>: 表示最多调用一次，可以不调用，但最多调用一次。</li>
<li><code>()</code>和<code>|</code>: 表示在多个方法之间，可以选择任意一个，并且多个方法之间不分前后顺序。</li>
<li><code>*</code>: 表示方法可以调用0次或多次。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">visit</span><br><span class="line">[visitSource][visitModule][visitNestHost][visitPermittedSubclass][visitOuterClass]</span><br><span class="line">(</span><br><span class="line"> visitAnnotation |</span><br><span class="line"> visitTypeAnnotation |</span><br><span class="line"> visitAttribute</span><br><span class="line">)*</span><br><span class="line">(</span><br><span class="line"> visitNestMember |</span><br><span class="line"> visitInnerClass |</span><br><span class="line"> visitRecordComponent |</span><br><span class="line"> visitField |</span><br><span class="line"> visitMethod</span><br><span class="line">)* </span><br><span class="line">visitEnd</span><br></pre></td></tr></table></figure>
</li>
<li><p>visit方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> <span class="keyword">int</span> version, // jdk版本</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> <span class="keyword">int</span> access, // 访问标识</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String name, // 类名</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String signature, // 当前类的泛型信息</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String superName, // 当前类的父类信息</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String[] interfaces)</span> </span>&#123; <span class="comment">// 实现接口</span></span><br><span class="line">  <span class="keyword">if</span> (api &lt; Opcodes.ASM8 &amp;&amp; (access &amp; Opcodes.ACC_RECORD) != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Records requires ASM8"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (cv != <span class="keyword">null</span>) &#123;</span><br><span class="line">    cv.visit(version, access, name, signature, superName, interfaces);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>visitField方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> FieldVisitor <span class="title">visitField</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> <span class="keyword">int</span> access, // 访问表示</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String name, // 字段名</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String descriptor, // 字段描述符</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String signature, // 泛型类型</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> Object value)</span> </span>&#123; <span class="comment">// 字段值</span></span><br><span class="line">  <span class="keyword">if</span> (cv != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> cv.visitField(access, name, descriptor, signature, value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>visitMethod方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> MethodVisitor <span class="title">visitMethod</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> <span class="keyword">int</span> access, // 访问标识</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String name, // 方法名</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String descriptor, // 方法描述符</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String signature, // 泛型类型</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> String[] exceptions)</span> </span>&#123; <span class="comment">// 异常</span></span><br><span class="line">  <span class="keyword">if</span> (cv != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> cv.visitMethod(access, name, descriptor, signature, exceptions);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="FieldVisitor类"><a href="#FieldVisitor类" class="headerlink" title="FieldVisitor类"></a>FieldVisitor类</h3><ul>
<li><p>一个抽象类</p>
</li>
<li><p>在<code>FieldVisitor</code>类内定义的多个<code>visitXxx()</code>方法，也需要遵循一定的调用顺序，如下所示：</p>
<ul>
<li><code>[]</code>: 表示最多调用一次，可以不调用，但最多调用一次。</li>
<li><code>()</code>和<code>|</code>: 表示在多个方法之间，可以选择任意一个，并且多个方法之间不分前后顺序。</li>
<li><code>*</code>: 表示方法可以调用0次或多次。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line"> visitAnnotation |</span><br><span class="line"> visitTypeAnnotation |</span><br><span class="line"> visitAttribute</span><br><span class="line">)*</span><br><span class="line">visitEnd</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="MethodVisitor类"><a href="#MethodVisitor类" class="headerlink" title="MethodVisitor类"></a>MethodVisitor类</h3><ul>
<li><p>一个抽象方法</p>
</li>
<li><p>遵循一定的调用顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(visitParameter)*</span><br><span class="line">[visitAnnotationDefault]</span><br><span class="line">(visitAnnotation | visitAnnotableParameterCount | visitParameterAnnotation | visitTypeAnnotation | visitAttribute)*</span><br><span class="line">[</span><br><span class="line">    visitCode</span><br><span class="line">    (</span><br><span class="line">        visitFrame |</span><br><span class="line">        visitXxxInsn |</span><br><span class="line">        visitLabel |</span><br><span class="line">        visitInsnAnnotation |</span><br><span class="line">        visitTryCatchBlock |</span><br><span class="line">        visitTryCatchAnnotation |</span><br><span class="line">        visitLocalVariable |</span><br><span class="line">        visitLocalVariableAnnotation |</span><br><span class="line">        visitLineNumber</span><br><span class="line">    )*</span><br><span class="line">    visitMaxs</span><br><span class="line">]</span><br><span class="line">visitEnd</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>visitXxx()</code>方法分成三组：</p>
<ul>
<li>第一组，在<code>visitCode()</code>方法之前的方法。这一组的方法，主要负责parameter、annotation和attributes等内容，这些内容并不是方法当中“必不可少”的一部分；暂时不去考虑这些内容，可以忽略这一组方法。</li>
<li>第二组，在<code>visitCode()</code>方法和<code>visitMaxs()</code>方法之间的方法。这一组的方法，主要负责当前方法的“方法体”内的opcode内容。其中，<code>visitCode()</code>方法，标志着方法体的开始，而<code>visitMaxs()</code>方法，标志着方法体的结束。</li>
<li>第三组，是<code>visitEnd()</code>方法。这个<code>visitEnd()</code>方法，是最后一个进行调用的方法。</li>
</ul>
</li>
</ul>
<h3 id="ClassWriter类"><a href="#ClassWriter类" class="headerlink" title="ClassWriter类"></a>ClassWriter类</h3><p><code>ClassVistor</code>的实现类，在创建<code>ClassWriter</code>对象的时候，要指定一个<code>flags</code>参数，它可以选择的值有三个：</p>
<ul>
<li>第一个，可以选取的值是<code>0</code>。ASM不会自动计算max stacks和max locals，也不会自动计算stack map frames。</li>
<li>第二个，可以选取的值是<code>ClassWriter.COMPUTE_MAXS</code>。ASM会自动计算max stacks和max locals，但不会自动计算stack map frames。</li>
<li>第三个，可以选取的值是<code>ClassWriter.COMPUTE_FRAMES</code>（推荐使用）。ASM会自动计算max stacks和max locals，也会自动计算stack map frames。</li>
</ul>
<h3 id="FieldWriter类"><a href="#FieldWriter类" class="headerlink" title="FieldWriter类"></a>FieldWriter类</h3><p><code>FieldVisitor</code>的具体实现类，<code>FieldWriter</code>类并不带有<code>public</code>修饰，因此它的有效访问范围只局限于它所处的package当中，不能像其它的<code>public</code>类一样被外部所使用。</p>
<h3 id="MethodWriter类"><a href="#MethodWriter类" class="headerlink" title="MethodWriter类"></a>MethodWriter类</h3><p><code>MethodWriter</code>类的父类是<code>MethodVisitor</code>类。在<code>ClassWriter</code>类里，<code>visitMethod()</code>方法的实现就是通过<code>MethodWriter</code>类来实现的。</p>
<p><code>MethodWriter</code>类并不带有<code>public</code>修饰，因此它的有效访问范围只局限于它所处的package当中，不能像其它的<code>public</code>类一样被外部所使用。</p>
<h2 id="生成一个类"><a href="#生成一个类" class="headerlink" title="生成一个类"></a>生成一个类</h2><h3 id="生成一个HelloWorld接口"><a href="#生成一个HelloWorld接口" class="headerlink" title="生成一个HelloWorld接口"></a>生成一个HelloWorld接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.objectweb.asm.Opcodes.*;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldGenerateCore</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = dump();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 字节码打印</span></span><br><span class="line">        BigInteger bigInteger = <span class="keyword">new</span> BigInteger(<span class="number">1</span>, bytes);</span><br><span class="line">        System.out.println(bigInteger.toString(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过反射defineClass0方法将字节码转对象</span></span><br><span class="line">        ClassLoader classLoader = ClassLoader.getSystemClassLoader();</span><br><span class="line">        Method method = Proxy.class.getDeclaredMethod("defineClass0",ClassLoader.class, String.class, byte[].class, int.class, int.class);</span><br><span class="line">        method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object obj = method.invoke(<span class="keyword">null</span>, classLoader, <span class="string">"sample.HelloWorld"</span>, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] dump() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// (1) 创建ClassWriter对象</span></span><br><span class="line">        ClassWriter cw = <span class="keyword">new</span> ClassWriter(ClassWriter.COMPUTE_FRAMES);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (2) 调用visitXxx()方法</span></span><br><span class="line">        cw.visit(</span><br><span class="line">                V1_8,                                        <span class="comment">// version</span></span><br><span class="line">                ACC_PUBLIC + ACC_ABSTRACT + ACC_INTERFACE,   <span class="comment">// access</span></span><br><span class="line">                <span class="string">"sample/HelloWorld"</span>,                         <span class="comment">// name</span></span><br><span class="line">                <span class="keyword">null</span>,                                        <span class="comment">// signature</span></span><br><span class="line">                <span class="string">"java/lang/Object"</span>,                          <span class="comment">// superName</span></span><br><span class="line">                <span class="keyword">null</span>                                         <span class="comment">// interfaces</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        cw.visitEnd();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (3) 调用toByteArray()方法</span></span><br><span class="line">        <span class="keyword">return</span> cw.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="生成一个HelloWorld类"><a href="#生成一个HelloWorld类" class="headerlink" title="生成一个HelloWorld类"></a>生成一个HelloWorld类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassWriter;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.MethodVisitor;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.Opcodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldClassGenerate</span> <span class="keyword">implements</span> <span class="title">Opcodes</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = dump();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 字节码打印</span></span><br><span class="line">        BigInteger bigInteger = <span class="keyword">new</span> BigInteger(<span class="number">1</span>, bytes);</span><br><span class="line">        System.out.println(bigInteger.toString(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过反射defineClass0方法将字节码转对象</span></span><br><span class="line">        ClassLoader classLoader = ClassLoader.getSystemClassLoader();</span><br><span class="line">        Method method = Proxy.class.getDeclaredMethod("defineClass0",ClassLoader.class, String.class, byte[].class, int.class, int.class);</span><br><span class="line">        method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object obj = method.invoke(<span class="keyword">null</span>, classLoader, <span class="string">"sample.HelloWorld"</span>, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] dump()&#123;</span><br><span class="line">        ClassWriter cw = <span class="keyword">new</span> ClassWriter(ClassWriter.COMPUTE_FRAMES);</span><br><span class="line"></span><br><span class="line">        cw.visit(V1_8, ACC_PUBLIC+ACC_SUPER, <span class="string">"sample/HelloWorld"</span>, <span class="keyword">null</span>, <span class="string">"java/lang/Object"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// 无参构造函数&lt;init&gt;</span></span><br><span class="line">        MethodVisitor mv = cw.visitMethod(ACC_PUBLIC, <span class="string">"&lt;init&gt;"</span>, <span class="string">"()V"</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        mv.visitCode();</span><br><span class="line">        mv.visitVarInsn(ALOAD, <span class="number">0</span>);</span><br><span class="line">        mv.visitMethodInsn(INVOKESPECIAL, <span class="string">"java/lang/Object"</span>, <span class="string">"&lt;init&gt;"</span>, <span class="string">"()V"</span>, <span class="keyword">false</span>);</span><br><span class="line">        mv.visitInsn(RETURN);</span><br><span class="line">        mv.visitMaxs(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        mv.visitEnd();</span><br><span class="line">        cw.visitEnd();</span><br><span class="line">        <span class="keyword">return</span> cw.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ASM读取类"><a href="#ASM读取类" class="headerlink" title="ASM读取类"></a>ASM读取类</h2><h3 id="ClassReader类"><a href="#ClassReader类" class="headerlink" title="ClassReader类"></a>ClassReader类</h3><ul>
<li><p>用于读取<code>.class</code>文件，区别于<code>ClassWriter</code></p>
</li>
<li><p>一个公共类，不继承<code>ClassVisitor</code>。</p>
</li>
<li><p>在<code>ClassReader</code>类当中定义了5个构造方法。但是，从本质上来说，这5个构造方法本质上是同一个构造方法的不同表现形式。其中，最常用的构造方法有两个</p>
<ul>
<li>第一个是<code>ClassReader cr = new ClassReader(&quot;sample.HelloWorld&quot;);</code></li>
<li>第二个是<code>ClassReader cr = new ClassReader(bytes);</code></li>
</ul>
</li>
<li><p>accept方法，这个方法接收一个<code>ClassVisitor</code>类型的参数，将<code>ClassReader</code>和<code>ClassVisitor</code>进行连接。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(<span class="keyword">final</span> ClassVisitor classVisitor, <span class="keyword">final</span> <span class="keyword">int</span> parsingOptions)</span> </span>&#123;</span><br><span class="line">    accept(classVisitor, <span class="keyword">new</span> Attribute[<span class="number">0</span>], parsingOptions);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>parsingOptions</code>参数可以选取的值有以下5个：</p>
<ul>
<li><code>0</code>：会生成所有的ASM代码，包括调试信息、frame信息和代码信息。</li>
<li><code>ClassReader.SKIP_CODE</code>：会忽略代码信息，例如，会忽略对于<code>MethodVisitor.visitXxxInsn()</code>方法的调用。</li>
<li><code>ClassReader.SKIP_DEBUG</code>：会忽略调试信息，例如，会忽略对于<code>MethodVisitor.visitParameter()</code>、<code>MethodVisitor.visitLineNumber()</code>和<code>MethodVisitor.visitLocalVariable()</code>等方法的调用。</li>
<li><code>ClassReader.SKIP_FRAMES</code>：会忽略frame信息，例如，会忽略对于<code>MethodVisitor.visitFrame()</code>方法的调用。</li>
<li><code>ClassReader.EXPAND_FRAMES</code>：会对frame信息进行扩展，例如，会对<code>MethodVisitor.visitFrame()</code>方法的参数有影响。</li>
</ul>
</li>
</ul>
<h2 id="读取一个类"><a href="#读取一个类" class="headerlink" title="读取一个类"></a>读取一个类</h2><h3 id="编译HelloWorld类"><a href="#编译HelloWorld类" class="headerlink" title="编译HelloWorld类"></a>编译HelloWorld类</h3><ul>
<li><p>编译<code>HelloWorld</code>类为Class文件，然后通过<code>ClassReader</code>读取Class文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sample;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">Exception</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="读取HelloWorld-class"><a href="#读取HelloWorld-class" class="headerlink" title="读取HelloWorld.class"></a>读取HelloWorld.class</h3><ul>
<li><p>使用<code>ClassReader</code>读取Class文件信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldRun</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 获取Class绝对路径</span></span><br><span class="line">        String relativePath = <span class="string">"sample/HelloWorld.class"</span>;</span><br><span class="line">        String absolutePath = HelloWorldRun.class.getResource("/").getPath() + relativePath;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 读取字节</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(absolutePath);</span><br><span class="line">        InputStream inputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        inputStream = <span class="keyword">new</span> BufferedInputStream(inputStream);</span><br><span class="line">        ByteArrayOutputStream byteArrayOutputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        copy(inputStream,  byteArrayOutputStream);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = byteArrayOutputStream.toByteArray();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）构建ClassReader</span></span><br><span class="line">        ClassReader cr = <span class="keyword">new</span> ClassReader(bytes);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (2) 调用getXxx()方法</span></span><br><span class="line">        <span class="keyword">int</span> access = cr.getAccess();</span><br><span class="line">        System.out.println(<span class="string">"access: "</span> + access);</span><br><span class="line"></span><br><span class="line">        String className = cr.getClassName();</span><br><span class="line">        System.out.println(<span class="string">"className: "</span> + className);</span><br><span class="line"></span><br><span class="line">        String superName = cr.getSuperName();</span><br><span class="line">        System.out.println(<span class="string">"superName: "</span> + superName);</span><br><span class="line"></span><br><span class="line">        String[] interfaces = cr.getInterfaces();</span><br><span class="line">        System.out.println(<span class="string">"interfaces: "</span> + Arrays.toString(interfaces));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copy</span><span class="params">(InputStream source, OutputStream target)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">8192</span>];</span><br><span class="line">        <span class="keyword">int</span> length;</span><br><span class="line">        <span class="keyword">while</span> ((length = source.read(buf)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            target.write(buf, <span class="number">0</span>, length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>输出结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">access: 33</span><br><span class="line">className: sample/HelloWorld</span><br><span class="line">superName: java/lang/Exception</span><br><span class="line">interfaces: [java/io/Serializable, java/lang/Cloneable]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="转换一个类"><a href="#转换一个类" class="headerlink" title="转换一个类"></a>转换一个类</h2><ul>
<li><code>ClassReader</code>类，是ASM提供的一个类，可以直接拿来使用。</li>
<li><code>ClassWriter</code>类，是ASM提供的一个类，可以直接拿来使用。</li>
<li><code>ClassVisitor</code>类，是ASM提供的一个抽象类，因此需要写代码提供一个<code>ClassVisitor</code>的子类，在这个子类当中可以实现对<code>.class</code>文件进行各种处理操作。</li>
</ul>
<h3 id="为HelloWorld类添加接口"><a href="#为HelloWorld类添加接口" class="headerlink" title="为HelloWorld类添加接口"></a>为HelloWorld类添加接口</h3><ul>
<li><p>编写HelloWorld.java类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始的HelloWorld.class文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> sample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过ASM的<code>ClassReader</code>、<code>ClassWriter</code>、<code>ClassVisitor</code>类对HelloWorld类进行转换，为其添加一个实现接口</p>
</li>
<li><p>编写HelloWorldCloneVisitor类继承ClassVisitor类来实现具体功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassVisitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldCloneVisitor</span> <span class="keyword">extends</span> <span class="title">ClassVisitor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorldCloneVisitor</span><span class="params">(<span class="keyword">int</span> api, ClassVisitor classVisitor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(api, classVisitor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写visit方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(<span class="keyword">int</span> version, <span class="keyword">int</span> access, String name, String signature, String superName, String[] interfaces)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.visit(version, access, name, signature, superName, <span class="keyword">new</span> String[]&#123;<span class="string">"java/lang/Cloneable"</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写HelloWorldTransform转换已有的class文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassReader;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassVisitor;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassWriter;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.Opcodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldTransform</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取Class绝对路径</span></span><br><span class="line">        String relativePath = <span class="string">"sample/HelloWorld.class"</span>;</span><br><span class="line">        String absolutePath = HelloWorldRun.class.getResource("/").getPath() + relativePath;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 读取字节</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(absolutePath);</span><br><span class="line">        InputStream inputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        inputStream = <span class="keyword">new</span> BufferedInputStream(inputStream);</span><br><span class="line">        ByteArrayOutputStream byteArrayOutputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        copy(inputStream,  byteArrayOutputStream);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes1 = byteArrayOutputStream.toByteArray();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）构建ClassReader</span></span><br><span class="line">        ClassReader cr = <span class="keyword">new</span> ClassReader(bytes1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）构建ClassWriter</span></span><br><span class="line">        ClassWriter cw = <span class="keyword">new</span> ClassWriter(ClassWriter.COMPUTE_FRAMES);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）串连ClassVisitor</span></span><br><span class="line">        <span class="keyword">int</span> api = Opcodes.ASM9;</span><br><span class="line">        ClassVisitor cv = <span class="keyword">new</span> HelloWorldCloneVisitor(api, cw);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）结合ClassReader和ClassVisitor</span></span><br><span class="line">        <span class="keyword">int</span> parsingOptions = ClassReader.SKIP_DEBUG | ClassReader.SKIP_FRAMES;</span><br><span class="line">        cr.accept(cv, parsingOptions);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（5）生成byte[]</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes2 = cw.toByteArray();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (6) 重新写入class文件</span></span><br><span class="line">        OutputStream outputStream = <span class="keyword">new</span> FileOutputStream(absolutePath);</span><br><span class="line">        BufferedOutputStream bufferedOutputStream = <span class="keyword">new</span> BufferedOutputStream(outputStream);</span><br><span class="line">        bufferedOutputStream.write(bytes2);</span><br><span class="line">        bufferedOutputStream.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copy</span><span class="params">(InputStream source, OutputStream target)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">8192</span>];</span><br><span class="line">        <span class="keyword">int</span> length;</span><br><span class="line">        <span class="keyword">while</span> ((length = source.read(buf)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            target.write(buf, <span class="number">0</span>, length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>转换后的HelloWorld.class文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> sample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="为HelloWorld类添加字段"><a href="#为HelloWorld类添加字段" class="headerlink" title="为HelloWorld类添加字段"></a>为HelloWorld类添加字段</h3><ul>
<li><p>编写HelloWorld.java类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始的HelloWorld.class文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> sample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写HelloWorldAddFieldVisitor类继承ClassVisitor类来实现具体功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassVisitor;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.FieldVisitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldAddFieldVisitor</span> <span class="keyword">extends</span> <span class="title">ClassVisitor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> fieldAccess;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String fieldName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String fieldDesc;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isFieldPresent;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorldAddFieldVisitor</span><span class="params">(<span class="keyword">int</span> api, ClassVisitor classVisitor, <span class="keyword">int</span> fieldAccess, String fieldName, String fieldDesc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(api, classVisitor);</span><br><span class="line">        <span class="comment">// 字段访问标识</span></span><br><span class="line">        <span class="keyword">this</span>.fieldAccess = fieldAccess;</span><br><span class="line">        <span class="comment">// 字段名称</span></span><br><span class="line">        <span class="keyword">this</span>.fieldName = fieldName;</span><br><span class="line">        <span class="comment">// 字段描述符</span></span><br><span class="line">        <span class="keyword">this</span>.fieldDesc = fieldDesc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FieldVisitor <span class="title">visitField</span><span class="params">(<span class="keyword">int</span> access, String name, String descriptor, String signature, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (name.equals(fieldName)) &#123;</span><br><span class="line">            isFieldPresent = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.visitField(access, name, descriptor, signature, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visitEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isFieldPresent) &#123;</span><br><span class="line">            FieldVisitor fv = <span class="keyword">super</span>.visitField(fieldAccess, fieldName, fieldDesc, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (fv != <span class="keyword">null</span>) &#123;</span><br><span class="line">                fv.visitEnd();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span>.visitEnd();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写HelloWorldTransform转换已有的class文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassReader;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassVisitor;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.ClassWriter;</span><br><span class="line"><span class="keyword">import</span> org.objectweb.asm.Opcodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldTransform</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取Class绝对路径</span></span><br><span class="line">        String relativePath = <span class="string">"sample/HelloWorld.class"</span>;</span><br><span class="line">        String absolutePath = HelloWorldRun.class.getResource("/").getPath() + relativePath;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 读取字节</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(absolutePath);</span><br><span class="line">        InputStream inputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        inputStream = <span class="keyword">new</span> BufferedInputStream(inputStream);</span><br><span class="line">        ByteArrayOutputStream byteArrayOutputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        copy(inputStream,  byteArrayOutputStream);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes1 = byteArrayOutputStream.toByteArray();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（1）构建ClassReader</span></span><br><span class="line">        ClassReader cr = <span class="keyword">new</span> ClassReader(bytes1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（2）构建ClassWriter</span></span><br><span class="line">        ClassWriter cw = <span class="keyword">new</span> ClassWriter(ClassWriter.COMPUTE_FRAMES);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（3）串连ClassVisitor</span></span><br><span class="line">        <span class="keyword">int</span> api = Opcodes.ASM9;</span><br><span class="line">        ClassVisitor cv = <span class="keyword">new</span> HelloWorldAddFieldVisitor(api, cw, Opcodes.ACC_PUBLIC, <span class="string">"objValue"</span>, <span class="string">"Ljava/lang/Object;"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（4）结合ClassReader和ClassVisitor</span></span><br><span class="line">        <span class="keyword">int</span> parsingOptions = ClassReader.SKIP_DEBUG | ClassReader.SKIP_FRAMES;</span><br><span class="line">        cr.accept(cv, parsingOptions);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//（5）生成byte[]</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes2 = cw.toByteArray();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (6) 重新写入class文件</span></span><br><span class="line">        OutputStream outputStream = <span class="keyword">new</span> FileOutputStream(absolutePath);</span><br><span class="line">        BufferedOutputStream bufferedOutputStream = <span class="keyword">new</span> BufferedOutputStream(outputStream);</span><br><span class="line">        bufferedOutputStream.write(bytes2);</span><br><span class="line">        bufferedOutputStream.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copy</span><span class="params">(InputStream source, OutputStream target)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">8192</span>];</span><br><span class="line">        <span class="keyword">int</span> length;</span><br><span class="line">        <span class="keyword">while</span> ((length = source.read(buf)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            target.write(buf, <span class="number">0</span>, length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>转换后的HelloWorld.class文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> sample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Object objValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Sys71m</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://www.sys71m.top/2022/03/23/ASM使用小结01/">https://www.sys71m.top/2022/03/23/ASM使用小结01/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ASM/">ASM</a><a class="post-meta__tags" href="/tags/IAST/">IAST</a><a class="post-meta__tags" href="/tags/Java/">Java</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/08/20/CodeQL如何分析闭源jar包/"><i class="fa fa-chevron-left">  </i><span>CodeQL如何分析闭源jar包</span></a></div><div class="next-post pull-right"><a href="/2020/12/28/2020年都干了啥/"><span>2020年都干了啥</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://www.sys71m.top/2022/03/23/ASM使用小结01/';
  this.page.identifier = '2022/03/23/ASM使用小结01/';
  this.page.title = 'ASM使用小结01';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'sys71m' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://sys71m.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://raw.githubusercontent.com/ttonys/MarkDownPic/master/test33.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2023 By Sys71m</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>