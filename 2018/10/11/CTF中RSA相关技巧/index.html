<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="CTF中RSA相关技巧"><meta name="keywords" content="CTF,RSA"><meta name="author" content="Sys71m"><meta name="copyright" content="Sys71m"><title>CTF中RSA相关技巧 | sys71m</title><link rel="shortcut icon" href="/lufei.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><link rel="alternate" href="/atom.xml" title="sys71m" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#RSA算法"><span class="toc-number">1.</span> <span class="toc-text">RSA算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分解N"><span class="toc-number">2.</span> <span class="toc-text">分解N</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#直接分解n"><span class="toc-number">2.1.</span> <span class="toc-text">直接分解n</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#网站查询"><span class="toc-number">2.1.1.</span> <span class="toc-text">网站查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#yafu工具分解"><span class="toc-number">2.1.2.</span> <span class="toc-text">yafu工具分解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pollard-rho方法"><span class="toc-number">2.1.3.</span> <span class="toc-text">Pollard rho方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Fermat算法"><span class="toc-number">2.1.4.</span> <span class="toc-text">Fermat算法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#公约数分解n"><span class="toc-number">2.2.</span> <span class="toc-text">公约数分解n</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#攻击类别"><span class="toc-number">3.</span> <span class="toc-text">攻击类别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#共享素数攻击"><span class="toc-number">3.1.</span> <span class="toc-text">共享素数攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#低加密指数攻击"><span class="toc-number">3.2.</span> <span class="toc-text">低加密指数攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#低解密指数攻击"><span class="toc-number">3.3.</span> <span class="toc-text">低解密指数攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#低加密指数广播攻击"><span class="toc-number">3.4.</span> <span class="toc-text">低加密指数广播攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Coppersmith-定理攻击"><span class="toc-number">3.5.</span> <span class="toc-text">Coppersmith 定理攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#共模攻击"><span class="toc-number">3.6.</span> <span class="toc-text">共模攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#惟密文攻击"><span class="toc-number">3.7.</span> <span class="toc-text">惟密文攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RSA填充攻击"><span class="toc-number">3.8.</span> <span class="toc-text">RSA填充攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#求解明文"><span class="toc-number">4.</span> <span class="toc-text">求解明文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RsaCtfTool"><span class="toc-number">5.</span> <span class="toc-text">RsaCtfTool</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://raw.githubusercontent.com/ttonys/gitPic/master/lufei.jpg"></div><div class="author-info__name text-center">Sys71m</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="https://github.com/ttonys">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">34</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">51</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">20</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://raw.githubusercontent.com/ttonys/MarkDownPic/master/test33.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">sys71m</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">CTF中RSA相关技巧</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-11</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/密码学/">密码学</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2018/10/11/CTF中RSA相关技巧/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2018/10/11/CTF中RSA相关技巧/"></span></a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2k</span><span class="post-meta__separator">|</span><span>Reading time: 9 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>RSA是CTF比赛中常见的一类问题，这学期也开了门信息安全数学基础（好难。），其中就有相关RSA的知识，正好梳理一下。</p>
<a id="more"></a>  
<h2 id="RSA算法"><a href="#RSA算法" class="headerlink" title="RSA算法"></a>RSA算法</h2><p>RSA是一种非对称加密算法，需要两个密钥来进行加密和解密，公开密钥（public key，简称公钥）和私有密钥（private key，简称私钥） ，公钥加密的信息只有私钥才能解开，私钥加密的信息只有公钥才能解开。</p>
<p>算法举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">选择两个质数，p和q.  //p=61,q=53</span><br><span class="line">计算n，n=p*q //n=3233，二进制 110010100001，密钥就是12位，实际应用中，RSA密钥一般是1024位，重要场合则为2048位。</span><br><span class="line">计算n的欧拉函数 // φ(n) = (p-1)(q-1)=3120</span><br><span class="line">随机选择一个整数e，e大于1小于φ(n)并且互质 //e=17  实际应用中，常常选择65537</span><br><span class="line">计算e对于φ(n)的模反元素d    //指有一个整数d，可以使得ed被φ(n)除的余数为1  17d + 3120k = 1  d=2753</span><br><span class="line">将n和e封装成公钥，n和d封装成私钥 //n=3233，e=17，d=2753，所以公钥就是 (3233,17)，私钥就是（3233, 2753）。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">加密： C ＝ M^E mod N</span><br><span class="line">解密： M ＝ C^D mod N</span><br></pre></td></tr></table></figure>
<h2 id="分解N"><a href="#分解N" class="headerlink" title="分解N"></a>分解N</h2><h3 id="直接分解n"><a href="#直接分解n" class="headerlink" title="直接分解n"></a>直接分解n</h3><h4 id="网站查询"><a href="#网站查询" class="headerlink" title="网站查询"></a>网站查询</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://factordb.com/</span><br></pre></td></tr></table></figure>
<h4 id="yafu工具分解"><a href="#yafu工具分解" class="headerlink" title="yafu工具分解"></a>yafu工具分解</h4><p>当p 和 q 存在相差过大或者过近较快</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yafu-x64.exe</span><br><span class="line">factor(3233)</span><br></pre></td></tr></table></figure>
<h4 id="Pollard-rho方法"><a href="#Pollard-rho方法" class="headerlink" title="Pollard rho方法"></a>Pollard rho方法</h4><p> 适用p，q相差较大的时候</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">0x4333AF6B43F36028D8D9650EC3EED3238541EE5C15E626C58C9EC33674A6D08D5B1F2580A1A0B07E9D853536CD994E197889D122701A62BB2A9E79559F3D5281014535F6C54F83CA8D9700EEB67D99AF318D20A5150AD46D622A6A12DE0A758EE7DF75F5D10F2FE2585F2348537787063321FFDAC91BB3C3D1D88CBD04A824ED</span></span><br><span class="line">x2 = <span class="number">1</span></span><br><span class="line">c = <span class="number">7</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    x1 = randint(<span class="number">1</span>, n)</span><br><span class="line">    x2 = pow(x2,<span class="number">2</span>,n)+c%n</span><br><span class="line">    fac = gcd(abs(x1-x2),n)</span><br><span class="line">    <span class="keyword">if</span> fac&gt;<span class="number">1</span> <span class="keyword">and</span> is_prime(fac):</span><br><span class="line">        <span class="keyword">print</span> fac</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> n/fac</span><br></pre></td></tr></table></figure>
<p>Pollard rho p-1算法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PollardRho_p_1</span><span class="params">(N)</span>:</span></span><br><span class="line">    a = i = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        a = pow(a, i, N)</span><br><span class="line">        d = gcd(a - <span class="number">1</span>, N)</span><br><span class="line">        <span class="keyword">if</span> d != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> d</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">3233</span></span><br><span class="line"></span><br><span class="line">res = PollardRho_p_1(n)</span><br><span class="line"><span class="keyword">print</span> res</span><br><span class="line"><span class="keyword">print</span> n/res</span><br></pre></td></tr></table></figure>
<h4 id="Fermat算法"><a href="#Fermat算法" class="headerlink" title="Fermat算法"></a>Fermat算法</h4><p>适用于 p q 相差不大的时候</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Fermat</span><span class="params">(n)</span>:</span></span><br><span class="line">    a = isqrt_rem(n)[<span class="number">0</span>]+<span class="number">1</span></span><br><span class="line">    b = a ** <span class="number">2</span> - n</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        q = isqrt_rem(b)</span><br><span class="line">        <span class="keyword">if</span> q[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> a - q[<span class="number">0</span>]</span><br><span class="line">        a += <span class="number">1</span></span><br><span class="line">        b = a ** <span class="number">2</span> - n</span><br><span class="line"></span><br><span class="line">n = <span class="number">3233</span></span><br><span class="line">res = Fermat(n)</span><br><span class="line"><span class="keyword">print</span> res</span><br><span class="line"><span class="keyword">print</span> n/res</span><br></pre></td></tr></table></figure>
<h3 id="公约数分解n"><a href="#公约数分解n" class="headerlink" title="公约数分解n"></a>公约数分解n</h3><p>使用相同的p，分别得知n1和n2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n1 = <span class="number">9051013965404084482870087864821455535159008696042953021965631089095795348830954383127323853272528967729311045179605407693592665683311660581204886571146327720288455874927281128121117323579691204792399913106627543274457036172455814805715668293705603675386878220947722186914112990452722174363713630297685159669328951520891938403452797650685849523658191947411429068829734053745180460758604283051344339641429819373112365211739216160420494167071996438506850526168389386850499796102003625404245645796271690310748804327</span></span><br><span class="line">n2 = <span class="number">13225948396179603816062046418717214792668512413625091569997524364243995991961018894150059207824093837420451375240550310050209398964506318518991620142575926623780411532257230701985821629425722030608722035570690474171259238153947095310303522831971664666067542649034461621725656234869005501293423975184701929729170077280251436216167293058560030089006140224375425679571181787206982712477261432579537981278055755344573767076951793312062480275004564657590263719816033564139497109942073701755011873153205366238585665743</span></span><br><span class="line">p = gmpy2.gcd(n1, n2)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'gcd(n1, n2):\n'</span>, p</span><br><span class="line">q1 = n1 / p</span><br><span class="line">q2 = n2 / p</span><br><span class="line"><span class="keyword">print</span> <span class="string">'q1 is:\n'</span>, q1</span><br><span class="line"><span class="keyword">print</span> <span class="string">'q2 is:\n'</span>, q2</span><br></pre></td></tr></table></figure>
<h2 id="攻击类别"><a href="#攻击类别" class="headerlink" title="攻击类别"></a>攻击类别</h2><h3 id="共享素数攻击"><a href="#共享素数攻击" class="headerlink" title="共享素数攻击"></a>共享素数攻击</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">   <span class="keyword">if</span> a &lt; b:</span><br><span class="line">     a, b = b, a</span><br><span class="line">   <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">     temp = a % b</span><br><span class="line">     a = b</span><br><span class="line">     b = temp</span><br><span class="line">   <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span><span class="params">(a, m)</span>:</span></span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'modular inverse does not exist'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">n2s</span><span class="params">(n)</span>:</span></span><br><span class="line">    s=hex(n)[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">if</span> len(s)%<span class="number">2</span>!=<span class="number">0</span>:</span><br><span class="line">        s=<span class="string">'0'</span>+s</span><br><span class="line">    <span class="keyword">return</span> s.decode(<span class="string">'hex'</span>)</span><br><span class="line"></span><br><span class="line">n4=<span class="number">18674375108313094928585156581138941368570022222190945461284402673204018075354069827186085851309806592398721628845336840532779579197302984987661547245423180760958022898546496524249201679543421158842103496452861932183144343315925106154322066796612415616342291023962127055311307613898583850177922930685155351380500587263611591893137588708003711296496548004793832636078992866149115453883484010146248683416979269684197112659302912316105354447631916609587360103908746719586185593386794532066034112164661723748874045470225129298518385683561122623859924435600673501186244422907402943929464694448652074412105888867178867357727</span></span><br><span class="line">n5=<span class="number">20071978783607427283823783012022286910630968751671103864055982304683197064862908267206049336732205051588820325894943126769930029619538705149178241710069113634567118672515743206769333625177879492557703359178528342489585156713623530654319500738508146831223487732824835005697932704427046675392714922683584376449203594641540794557871881581407228096642417744611261557101573050163285919971711214856243031354845945564837109657494523902296444463748723639109612438012590084771865377795409000586992732971594598355272609789079147061852664472115395344504822644651957496307894998467309347038349470471900776050769578152203349128951</span></span><br><span class="line">c4=<span class="number">0x8C3CF3161AA3E37831030985C60566A7604688B73E5B1D3B36E72EF06ED4F71289EFE80E0D94BD755034E6C210F17DA85B9D0388F3AD104C68BC514A8EB1569A109EB5F266F7C5FA4DDFA638258949B43D4CF1406720CCD4CA11E74FDF8AEB35C56A79781C87157FC4213573329C5B0FF411F8A4F34580AA103DB9FD403C0D409FA11860A7C4595FDC49DC2CF94E5112B772E5DEC8F17E24B10A7FD7A95DCB87BE5E27C32FC931574A7847BC506A61EFE9DB3D3F612143845FE80D7B3EA548B886A67A29CBDB2775B1F91178B6DA763F1A6ECFF46592E4C7FFAAB6C9FEF29D9CB9E035A3D98ECFFB26BA2EEAA56D1CD096E6A2CF9A58086CAD7718DDA5CB0C1B</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line"></span><br><span class="line">p4=gcd(n4,n5)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"p4"</span>,p4</span><br><span class="line">q4=n4/p4</span><br><span class="line">q5=n5/p4</span><br><span class="line"><span class="comment"># print "q4",q4</span></span><br><span class="line"><span class="comment"># print "q5",q5</span></span><br><span class="line">phi=(p4<span class="number">-1</span>)*(q5<span class="number">-1</span>)</span><br><span class="line">d4=modinv(e,phi)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"d4"</span>,d4</span><br><span class="line">m=pow(c4,d4,n5)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m=%s"</span>%m</span><br><span class="line"><span class="keyword">print</span> <span class="string">"flag is"</span>,n2s(int(m))</span><br></pre></td></tr></table></figure>
<h3 id="低加密指数攻击"><a href="#低加密指数攻击" class="headerlink" title="低加密指数攻击"></a>低加密指数攻击</h3><p>e=3 时的小明文攻击(e = 3 且明文很小)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: cp936 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line"><span class="comment"># 读入 n, 密文 c</span></span><br><span class="line">n= <span class="number">22885480907469109159947272333565375109310485067211461543881386718201442106967914852474989176175269612229966461160065872310916096148216253429849921988412342732706875998100337754561586600637594798877898552625378551427864501926224989873772743227733285336042475675299391051376624685754547818835551263597996620383338263448888107691240136257201191331617560711786674975909597833383395574686942099700631002290836152972352041024137872983284691831292216787307841877839674258086005814225532597955826353796634417780156185485054141684249037538570742860026295194559710972266059844824388916869414355952432189722465103299013237588737</span></span><br><span class="line">c= <span class="number">15685364647213619014219110070569189770745535885901269792039052046431067708991036961644224230125219358149236447900927116989931929305133870392430610563331490276096858863490412102016758082433435355613099047001069687409209484751075897343335693872741</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]Detecting m...'</span></span><br><span class="line">result = gmpy2.iroot(c, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'  [-]The c has cubic root?'</span>, result[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> result[<span class="number">1</span>]: <span class="keyword">print</span> <span class="string">'  [-]The m is:'</span>, <span class="string">'&#123;:x&#125;'</span>.format(result[<span class="number">0</span>]).decode(<span class="string">'hex'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[!]All Done!'</span></span><br></pre></td></tr></table></figure>
<p>e=3 时的小明文攻击(e = 3 且明文的三次方比 n 大，但是不是足够大)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2, time</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line"><span class="comment"># 读入 n, 密文</span></span><br><span class="line">n = <span class="number">114976915747243387792157708464120735018971336213935438953074748276198282761939060395482051056351068439137722626185590043024556656813730840050547350912425438364703854627760482842307943026011880815011654341047422453012558617703411700393668892701036222135444420377515575624398723436532681305293727164639582093389</span></span><br><span class="line">c = <span class="number">5828813410620741112500628876643872258919868379601617907887884191584237969605489971465692568848339200057188383649365078832766143513766368216471491824042974016773526107276856706832404477882581400769791378958901067683158857990261489285951805740071223765359992165262854641069674603160977034446644199945940251030</span></span><br><span class="line">i = <span class="number">239000000</span> <span class="comment"># i 应该是未知的。这里缩短一下距离, 防止跑得太久</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]Detecting m...'</span></span><br><span class="line">s = time.clock()</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    m, b = gmpy2.iroot(c + i * n, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> b:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'  [-]m is: '</span> + <span class="string">'&#123;:x&#125;'</span>.format(int(m)).decode(<span class="string">'hex'</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#print '  [-]i = %d\r' % i,</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'[!]Timer:'</span>, round(time.clock() - s, <span class="number">2</span>), <span class="string">'s'</span></span><br></pre></td></tr></table></figure>
<h3 id="低解密指数攻击"><a href="#低解密指数攻击" class="headerlink" title="低解密指数攻击"></a>低解密指数攻击</h3><p>与低加密指数相同，低解密指数可以加快解密的过程，但是者也带来了安全问题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># 展开为连分数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">continuedFra</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    cF = []</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        cF += [x / y]</span><br><span class="line">        x, y = y, x % y</span><br><span class="line">    <span class="keyword">return</span> cF</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Simplify</span><span class="params">(ctnf)</span>:</span></span><br><span class="line">    numerator = <span class="number">0</span></span><br><span class="line">    denominator = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> ctnf[::<span class="number">-1</span>]:</span><br><span class="line">        numerator, denominator = denominator, x * denominator + numerator</span><br><span class="line">    <span class="keyword">return</span> (numerator, denominator)</span><br><span class="line"><span class="comment"># 连分数化简</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculateFrac</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    cF = continuedFra(x, y)</span><br><span class="line">    cF = map(Simplify, (cF[<span class="number">0</span>:i] <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, len(cF))))</span><br><span class="line">    <span class="keyword">return</span> cF</span><br><span class="line"><span class="comment"># 解韦达定理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_pq</span><span class="params">(a, b, c)</span>:</span></span><br><span class="line">    par = gmpy2.isqrt(b * b - <span class="number">4</span> * a * c)</span><br><span class="line">    <span class="keyword">return</span> (-b + par) / (<span class="number">2</span> * a), (-b - par) / (<span class="number">2</span> * a)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wienerAttack</span><span class="params">(e, n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> (d, k) <span class="keyword">in</span> calculateFrac(e, n):</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> (e * d - <span class="number">1</span>) % k != <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">        phi = (e * d - <span class="number">1</span>) / k</span><br><span class="line">        p, q = solve_pq(<span class="number">1</span>, n - phi + <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> p * q == n:</span><br><span class="line">            <span class="keyword">return</span> abs(int(p)), abs(int(q))</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'not find!'</span></span><br><span class="line">time.clock()</span><br><span class="line">n = <span class="number">12238605063252292170613110607692779326628090745751955692266649177882959231822580682548279800443278979485092243645806337103841086023159482786712759291169541633901936290854044069486201989034158882661270017305064348254800318759062921744741432214818915527537124001063995865927527037625277330117588414586505635959411443039463168463608235165929831344586283875119363703480280602514451713723663297066810128769907278246434745483846869482536367912810637275405943566734099622063142293421936734750356828712268385319217225803602442033960930413469179550331907541244416573641309943913383658451409219852933526106735587605884499707827</span></span><br><span class="line">e = <span class="number">11850552481503020257392808424743510851763548184936536180317707155841959788151862976445957810691568475609821000653594584717037528429828330763571556164988619635320288125983463358648887090031957900011546300841211712664477474767941406651977784177969001025954167441377912326806132232375497798238928464025466905201977180541053129691501120197010080001677260814313906843670652972019631997467352264392296894192998971542816081534808106792758008676039929763345402657578681818891775091140555977382868531202964486261123748663752490909455324860302967636149379567988941803701512680099398021640317868259975961261408500449965277690517</span></span><br><span class="line">c = <span class="number">9472193174575536616954091686751964873836697237500198884451530469300324470671555310791335185133679697207007374620225900775502162690848135615431624557389304657410880981454777737587420426091879654002644281066474715074536611611252677882396384453641127487515845176069574754606670518031472235144795376526854484442135299818868525539923568705203042265537204111153151119105287648912908771710419648445826883069030285651763726003413418764301988228077415599665616637501056116290476861280240577145515875430665394216054222788697052979429015400411487342877096677666406389711074591330476335174211990429870900468249946600544116793793</span></span><br><span class="line">p, q = wienerAttack(e, n)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]Found!'</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'  [-]p ='</span>,p</span><br><span class="line"><span class="keyword">print</span> <span class="string">'  [-]q ='</span>,q</span><br><span class="line"><span class="keyword">print</span> <span class="string">'  [-]n ='</span>,p*q</span><br><span class="line">d = gmpy2.invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line"><span class="keyword">print</span> <span class="string">'  [-]d ='</span>, d</span><br><span class="line"><span class="keyword">print</span> <span class="string">'  [-]m is:'</span> + <span class="string">'&#123;:x&#125;'</span>.format(pow(c,d,n)).decode(<span class="string">'hex'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'\n[!]Timer:'</span>, round(time.clock(),<span class="number">2</span>), <span class="string">'s'</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'[!]All Done!'</span></span><br></pre></td></tr></table></figure>
<h3 id="低加密指数广播攻击"><a href="#低加密指数广播攻击" class="headerlink" title="低加密指数广播攻击"></a>低加密指数广播攻击</h3><p>选取的加密指数较低，并且使用了相同的加密指数给一个接受者的群发送相同的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c1 ≡ m^e mod(n1) </span><br><span class="line">c2 ≡ m^e mod(n2) </span><br><span class="line">c3 ≡ m^e mod(n3) </span><br><span class="line">........</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: cp936 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CRT</span><span class="params">(items)</span>:</span></span><br><span class="line">    N = reduce(<span class="keyword">lambda</span> x, y: x * y, (i[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> items))</span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> a, n <span class="keyword">in</span> items:</span><br><span class="line">        m = N / n</span><br><span class="line">        d, r, s = gmpy2.gcdext(n, m)</span><br><span class="line">        <span class="keyword">if</span> d != <span class="number">1</span>: <span class="keyword">raise</span> Exception(<span class="string">"Input not pairwise co-prime"</span>)</span><br><span class="line">        result += a * s * m</span><br><span class="line">    <span class="keyword">return</span> result % N, N</span><br><span class="line"><span class="comment"># 读入 e, n, c</span></span><br><span class="line">e = <span class="number">9</span></span><br><span class="line">n = [<span class="number">142782424368849674771976671955176187834932417027468006479038058385550042422280158726561712259205616626939123504489410624745195777853423961104590708231562726165590769610040722589287393102301338152085670464005026301781192671834390892019478189768725018303217559795377795540494239283891894830166363576205812991157L</span>, <span class="number">153610425077816156109768509904751446801233412970601397035720458311275245730833227428213917577405780162151444202393431444812010569489900435979730559895340377469612234558042643742219128033827948585534761030527275423811282367831985007507137144308704413007806012914286105842311420933479771294576841956749281552971L</span>, <span class="number">152540067782701001222493009941492423063369171831039847414320547494725020441901272486665728360741395415762864872737675660423920609681185809510355937534756399208661762715484879562585724584849261266873624875852300611683382543315580370484972470694466195837255994159609193239840228218925381488410059939975556977947L</span>, <span class="number">125842716702134814646356078531900645012495638692517778270527426844383063904041812273637776798591687732598509470005151551320457132061693618473039437320011446697406190781306264437609046721508738109650829547010385875425097336266103994639126319889016342284747700714199556143378526590058467791687837422897022829661L</span>, <span class="number">116144389285266462769913139639175922392318396923181100785008570884082681963637784423143843845816350379438789947802939701820129805341796427821894273985551331666719808355412080909245720551238149511778060242720419584504473490216670437024863860559347959698828131475160058721701582089480924088773887932997353631767L</span>, <span class="number">127833907448946785858374094953899556339175475846831397383049660262333005992005484987913355932559627279178940862787593749842796469355336182379062826441222705075178971785791223706944120681105575965622931327112817747065200324610697178273898956820957640413744954233327851461318200323486469677469950386824833536523L</span>, <span class="number">130561613227079478921314550968562766645507834694262831586725464124109153306162445639759476845681271537955934718244296904503168256991962908095007040044300188572466395275317838178325500238288302672390013747102961340256309124310478931896245221622317302428447389760864327859640573452084295225059466376349115703119L</span>, <span class="number">115953389401040751013569404909249958538962411171147823610874077094621794755967854844224923689925397631692572916641171075740839099217316101334941033937183815345038898177087515909675028366437302462022970987947264115373697445950951595479758872029099661065186221250394358255523574834723958546450323357472451930993L</span>, <span class="number">143437107845384843564651522639125300763388830136500260725097766445883003928355325003575359566631064630487365774344508496878731109174874449170057678821440711511966073934025028100604234445470976333825866939923998344367645612128590820812489407412175198698290167077116185959180877334222693344630253253476594907313L</span>]</span><br><span class="line">c = [<span class="number">85033868418784308573673709960700777350314426427677627319697346811123742342359072170220428874952996988431950989321281905284522596263957356289624365171732095210045916218066135140320107686084053271623461104022705353814233772164502775939590711842361956121603943483040254727995655776263673058788416722141673409688L</span>, <span class="number">66065963470666895005407449599703926269325406456711861190876894466341571726360462706664546294453572319565476664348345756905411939632955966517708138047546806602828064213238537646393524578984547577761559965654539771172357089802682793169968961304179886652390277814477825753096636750388350662980872556701402397564L</span>, <span class="number">116011740820520887443111656288411611070614127688662643257265381793048354928820176624229624692124188995846076431510548507016903260774215950803926107831505634778278712070141663189086436127990584944132764896694777031370995058271038329228336417590284517922855284619653301817355115583540545182119702335431334401666L</span>, <span class="number">97640420284096094887471273365295984332267897927392169402918423863919914002451127544715668846623138003564829254309568918651163254043205129883843425179687841236818720463784828905460885026290909768599562386370732119591181513319548915478512030197629196018254041500662654260834562708620760373487652389789200792120L</span>, <span class="number">8112507653841374573057048967617108909055624101437903775740427861003476480616929517639719198652146909660899632120639789106782550275648578142883715280547602249589837441805676364041484345030575130408744621981440093280624046635769338568542048839419939250444929802135605724150484414516536378791500915047844188300L</span>, <span class="number">36792148360808115566234645242678223867680969786675055638670907933041180936164293809961667801099516457636164692292891528415720085345494773373966277807505798679784807614784581861287048096977968620964436947452527540958289441390882589051225367658014709290392321808926567572528170531844664734909469690750971883323L</span>, <span class="number">53043093283305492238903255767698153246673671181809989362223466090875767705978690531154079519999671834688647277179370374802495005937892824566602423646978168777735383632928274082669949750078161820002768640908750005814934158829006019656592134357897586040866207754535586785064545866404380204728594863102313407789L</span>, <span class="number">88499407133762624445946519155722583633934260410706930537441122463087556094734626189377091740335667052378955691250910459790202385799502439716173363179773811920751410726795431402796346647688144853156900427797933862087074385441977254140336390678022955770879265490567987868532251217565094093318626424653599450992L</span>, <span class="number">138337520305048557335599940473834485492131424901034295018189264168040969172072024612859307499682986987325414798210700710891033749119834960687318156171051379643844580970963540418974136891389303624057726575516576726845229494107327508855516437230240365759885913142671816868762838801720492804671259709458388192984L</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]Detecting m...'</span></span><br><span class="line">data = zip(c, n)</span><br><span class="line">x, n = CRT(data)</span><br><span class="line">realnum = gmpy2.iroot(gmpy2.mpz(x), e)[<span class="number">0</span>].digits()</span><br><span class="line"><span class="keyword">print</span> <span class="string">'  [-]m is: '</span> + <span class="string">'&#123;:x&#125;'</span>.format(int(realnum)).decode(<span class="string">'hex'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[!]All Done!'</span></span><br></pre></td></tr></table></figure>
<h3 id="Coppersmith-定理攻击"><a href="#Coppersmith-定理攻击" class="headerlink" title="Coppersmith 定理攻击"></a>Coppersmith 定理攻击</h3><p>如果 e = 3 并且在明文当中只有三分之二的比特是已知的，这种算法可以求出明文中所有的比特。</p>
<p>暂未有python脚本，需要依靠sage运行。</p>
<p>sage在线运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://sagecell.sagemath.org/</span><br></pre></td></tr></table></figure>
<h3 id="共模攻击"><a href="#共模攻击" class="headerlink" title="共模攻击"></a>共模攻击</h3><p>如果在 RSA 的使用中使用了相同的模 n 对相同的明文 m 进行了加密，那么就可以在不分解 n 的情况下还原出明文 m 的值。例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c1 ≡ m^e1 mod(n)</span><br><span class="line">c2 ≡ m^e2 mod(n)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n = <span class="number">158052722013789461456896900244510199169216575693048895162538548356466884311543740968048825149608833390255268602486435690724338965409521812963337715301197225841194835534751041470231293288252951274190599189716955573428884560130364021535005115652592074445852835422027406556727605302404510264249211145063332337043</span></span><br><span class="line">e = [<span class="number">665213</span>, <span class="number">368273</span>]</span><br><span class="line">c = [<span class="number">16698617641888248664694980135332125531792692516788088682722832061393117609508765284473236240256421599515450690670639565968165473479697383505401285976148490839526672808730165847471005704945978274496508928460578173068717106075169723401049489389383596761956301440156581021583368058047939083755488885694261340425L</span>, <span class="number">59192887933967939708054321952273893559113509451228797382728687616356609407020086787061368452871936378934964292805289941535766263083244529814852043063188312786173717046316177403357053871483983775362121186037776932260378728059531236711960979620603784044468207000654149190295060179235411429700710154759043236436L</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'[+]Detecting m...'</span></span><br><span class="line">time.clock()</span><br><span class="line">c1 = c[<span class="number">0</span>]</span><br><span class="line">c2 = c[<span class="number">1</span>]</span><br><span class="line">e1 = e[<span class="number">0</span>]</span><br><span class="line">e2 = e[<span class="number">1</span>]</span><br><span class="line">s = gmpy2.gcdext(e1, e2)</span><br><span class="line">s1 = s[<span class="number">1</span>]</span><br><span class="line">s2 = s[<span class="number">2</span>]</span><br><span class="line"><span class="comment"># 求模反元素</span></span><br><span class="line"><span class="keyword">if</span> s1 &lt; <span class="number">0</span>:</span><br><span class="line">    s1 = -s1</span><br><span class="line">    c1 = gmpy2.invert(c1, n)</span><br><span class="line"><span class="keyword">elif</span> s2 &lt; <span class="number">0</span>:</span><br><span class="line">    s2 = -s2</span><br><span class="line">    c2 = gmpy2.invert(c2, n)</span><br><span class="line">m = pow(c1, s1, n) * pow(c2, s2, n) % n</span><br><span class="line"><span class="keyword">print</span> <span class="string">'  [-]m is:'</span> + <span class="string">'&#123;:x&#125;'</span>.format(int(m)).decode(<span class="string">'hex'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'\n[!]Timer:'</span>, round(time.clock(),<span class="number">2</span>), <span class="string">'s'</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'[!]All Done!'</span></span><br></pre></td></tr></table></figure>
<h3 id="惟密文攻击"><a href="#惟密文攻击" class="headerlink" title="惟密文攻击"></a>惟密文攻击</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">135176830582884945708175419898330054260341730432046991449072509302750602166218145078102928897914789996197402658592881347572949256377161172079344803330624352445165759925647345536051853372740246104804540179716136644319380454884518397455488002758429914465640804944658049262500561494830899678619427468784748988379</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#此处省略，e为一个数组</span></span><br><span class="line">e=[<span class="number">16134430023258548730010506045817091253155174425491881198907194715118954323695812336073213399871465210437714290660793750993901158895347504391868395700741645371075639198152273525950825146531135058288489554248120363468547141254348480876412747258441592280958249727177410724447721846508001799108380403113466360976</span>,</span><br><span class="line"><span class="number">42049987057628216924853296358410744214687251846473269604612874558254990642148191390876361459813576275183122962464223793485259071516276247532052835955832348691869457924560348867958406099304998216749504364748794941667144230772792510413613315946446623009373130765396604094236638082912168404057545885783023655600</span>,</span><br><span class="line">........,</span><br><span class="line">........,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isCoPrime</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    ma = <span class="number">0</span></span><br><span class="line">    mi = <span class="number">0</span></span><br><span class="line">    ma=max(x,y)</span><br><span class="line">    mi=min(x,y)</span><br><span class="line">    <span class="keyword">if</span> x==<span class="number">1</span> <span class="keyword">or</span> y==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> x % y == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">print</span> x</span><br><span class="line">        <span class="keyword">print</span> y</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> isCoPrime(mi,ma % mi)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(e)):</span><br><span class="line">    <span class="keyword">print</span> i,isCoPrime(n,e[i])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> n,<span class="number">10367615840240242845371941453623373821227053765532752994306127876946421006862147600725324340607889088707606730457021312059130583835286311559997627141422127</span>*<span class="number">13038371855775914836995578093728166671103633520203033965827703187246607207039273968425501296569317295959057439253867586769212037981452712871242668046329877</span></span><br></pre></td></tr></table></figure>
<h3 id="RSA填充攻击"><a href="#RSA填充攻击" class="headerlink" title="RSA填充攻击"></a>RSA填充攻击</h3><p>例题:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long, inverse</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(len(flag) &lt; <span class="number">87</span>) <span class="comment"># leave space for padding since padding is secure</span></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">d = inverse(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">m = bytes_to_long(flag.center(<span class="number">255</span>,<span class="string">"\x00"</span>)) <span class="comment"># pad on both sides for extra security</span></span><br><span class="line">c = pow(m,e,n)</span><br><span class="line">print(<span class="string">"n = &#123;&#125;"</span>.format(n))</span><br><span class="line">print(<span class="string">"e = &#123;&#125;"</span>.format(e))</span><br><span class="line">print(<span class="string">"c = &#123;&#125;"</span>.format(c))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n = 16930533490098193592341875268338741038205464836112117606904075086009220456281348541825239348922340771982668304609839919714900815429989903238980995651506801223966153299092163805895061846586943843402382398048697158458017696120659704031304155071717980681280735059759239823752407134078600922884956042774012460082427687595370305553669279649079979451317522908818275946004224509637278839696644435502488800296253302309479834551923862247827826150368412526870932677430329200284984145938907415715817446807045958350179492654072137889859861558737138356897740471740801040559205563042789209526133114839452676031855075611266153108409</span><br><span class="line">e = 3</span><br><span class="line">c = 11517346521350511968078082236628354270939363562359338628104189053516869171468429130280219507678669249746227256625771360798579618712012428887882896227522052222656646536694635021145269394726332158046739239080891813226092060005024523599517854343024406506186025829868533799026231811239816891319566880015622494533461653189752596749235331065273556793035000698955959016688177480102004337980417906733597189524580640648702223430440368954613314994218791688337730722144627325417358973332458080507250983131615055175113690064940592354460257487958530863702022217749857014952140922260404696268641696045086730674980684704510707326989</span><br></pre></td></tr></table></figure>
<p>POC：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> integer_nthroot</span><br><span class="line">n = <span class="number">16930533490098193592341875268338741038205464836112117606904075086009220456281348541825239348922340771982668304609839919714900815429989903238980995651506801223966153299092163805895061846586943843402382398048697158458017696120659704031304155071717980681280735059759239823752407134078600922884956042774012460082427687595370305553669279649079979451317522908818275946004224509637278839696644435502488800296253302309479834551923862247827826150368412526870932677430329200284984145938907415715817446807045958350179492654072137889859861558737138356897740471740801040559205563042789209526133114839452676031855075611266153108409</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">11517346521350511968078082236628354270939363562359338628104189053516869171468429130280219507678669249746227256625771360798579618712012428887882896227522052222656646536694635021145269394726332158046739239080891813226092060005024523599517854343024406506186025829868533799026231811239816891319566880015622494533461653189752596749235331065273556793035000698955959016688177480102004337980417906733597189524580640648702223430440368954613314994218791688337730722144627325417358973332458080507250983131615055175113690064940592354460257487958530863702022217749857014952140922260404696268641696045086730674980684704510707326989</span></span><br><span class="line">seen = []</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> range(<span class="number">87</span>):</span><br><span class="line">    print(l)</span><br><span class="line">    lp = (<span class="number">255</span>-l)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> lp <span class="keyword">in</span> seen:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        seen.append(lp)</span><br><span class="line"></span><br><span class="line">    A = <span class="number">2</span>**(<span class="number">8</span>*lp*e)</span><br><span class="line">    Ainv = inverse(A,n)</span><br><span class="line">    cu = (c*Ainv)%n</span><br><span class="line">    bam = <span class="number">24</span>*l - <span class="number">2048</span> + <span class="number">1</span></span><br><span class="line">    bam = bam+<span class="number">1</span> <span class="keyword">if</span> bam&gt;<span class="number">0</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>**bam):</span><br><span class="line">        m = integer_nthroot(cu+j*n,<span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line">        m = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b'actf'</span> <span class="keyword">in</span> m:</span><br><span class="line">            print(m)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h2 id="求解明文"><a href="#求解明文" class="headerlink" title="求解明文"></a>求解明文</h2><p>已知p，q，e，c：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = gmpy2.mpz(<span class="number">9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483</span>)</span><br><span class="line">q = gmpy2.mpz(<span class="number">11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407</span>)</span><br><span class="line">e = gmpy2.mpz(<span class="number">65537</span>)</span><br><span class="line">phi_n = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e, phi_n)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"private key:"</span></span><br><span class="line"><span class="keyword">print</span> d</span><br><span class="line"></span><br><span class="line">c = gmpy2.mpz(<span class="number">83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"plaintext:"</span></span><br><span class="line"><span class="keyword">print</span> pow(c,d,p*q)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p = gmpy2.mpz(<span class="number">18443</span>)</span><br><span class="line">q = gmpy2.mpz(<span class="number">49891</span>)</span><br><span class="line">L = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">e = <span class="number">19</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'rsaroll.txt'</span>) <span class="keyword">as</span> File_project:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> File_project:</span><br><span class="line">        c = int(line.strip())</span><br><span class="line">        d = gmpy2.invert(e,L)</span><br><span class="line">        print(pow(c,d,p*q),end=<span class="string">' '</span>)</span><br></pre></td></tr></table></figure>
<h2 id="RsaCtfTool"><a href="#RsaCtfTool" class="headerlink" title="RsaCtfTool"></a>RsaCtfTool</h2><p>项目地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Ganapati/RsaCtfTool</span><br></pre></td></tr></table></figure>
<p>已知公钥(自动求私钥) —publickey，密文 ——uncipherfile：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python RsaCtfTool.py --publickey 公钥文件 --uncipherfile 加密的文件</span><br><span class="line">python RsaCtfTool.py --publickey pub_key.pem --uncipherfile enc.txt</span><br></pre></td></tr></table></figure>
<p>已知公钥求私钥：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RsaCtfTool.py --publickey pub_key.pem --private</span><br></pre></td></tr></table></figure>
<p>密钥格式转换：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">把PEM格式的公钥转换为n，e</span><br><span class="line">python RsaCtfTool.py --dumpkey --key pub_key.pem</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">把n,e转换为PEM格式</span><br><span class="line">python RsaCtfTool.py --createpub -n 782837482376192871287312987398172312837182 -e 65537</span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Sys71m</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://www.sys71m.top/2018/10/11/CTF中RSA相关技巧/">https://www.sys71m.top/2018/10/11/CTF中RSA相关技巧/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/RSA/">RSA</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/10/20/SoapClient-CRLF进行SSRF/"><i class="fa fa-chevron-left">  </i><span>SoapClient+CRLF进行SSRF</span></a></div><div class="next-post pull-right"><a href="/2018/08/03/Ruby_ERB模板注入/"><span>Ruby_ERB模板注入</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://www.sys71m.top/2018/10/11/CTF中RSA相关技巧/';
  this.page.identifier = '2018/10/11/CTF中RSA相关技巧/';
  this.page.title = 'CTF中RSA相关技巧';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'sys71m' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://sys71m.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://raw.githubusercontent.com/ttonys/MarkDownPic/master/test33.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2022 By Sys71m</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>